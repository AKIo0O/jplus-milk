<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>J+ Library</title>
		<script src="../../system/core/assets/scripts/base.js" type="text/javascript"></script>
		<script src="../../system/utils/assets/scripts/deferred.js" type="text/javascript"></script>
		
		<script src="../../assets/demo/demo.js" type="text/javascript"></script>
	</head>
	<body>
		
        
        <script>


            var Fx = Deferred.extend({

                run: function (options, link) {
                    var me = this;
                    if (me.defer(options, link))
                        return;
                    me.options = options;
                    me.resume();
                },

                done: function () {
                    var me = this;
                    trace('fx  done');
                    me.progress();
                },

                pause: function () {
                    var me = this;
                    clearTimeout(me.timer);
                },

                onCallback: function () {
                    var me = this;
                    trace(me.options);
                    me.done();
                },

                resume: function () {
                    var me = this;
                    me.timer = setTimeout(me.onCallback.bind(me), 1000);
                }

            });

            var fx = new Fx();


            fx.run('1', 'wait');

            fx.run('2', 'wait');

            fx.then(function () {
                trace('3');
            });

            var fx2 = new Fx();

            fx2.wait(fx);

            var fx3 = new Fx();

            fx3.wait(fx2);

            fx2.run('4', 'wait');

            fx3.run('5', 'wait');



            // 创建一个新的 Deferred 对象。
           // var d = new Deferred();

            // 添加 Deferred 对象执行结束后的回调函数。
            /*d.then(function () {
                alert('执行完成了');
            });*/

            // 设置 Deferred 对象实际执行的函数。
            /*d.run = function () {
                var me = this;
                setTimeout(function () {

                    // 通知当前类程序已经执行完成。
                    me.done();
                }, 500);
            };*/

            // 自己执行 Deferred 对象对应的函数。
           // d.start("1");
          //  d.start("2");
          //  d.abort();
          //  d.start("3");
          //  d.start("4");
          //  d.start("5");


        </script>
		
		
		
		
	</body>
</html>