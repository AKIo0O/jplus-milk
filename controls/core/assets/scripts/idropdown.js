/** * @author xuld */imports("Controls.Core.IDropDown");using("System.Dom.Align");/** * 所有支持下拉菜单的组件实现的接口。 */var IDropDown = {		/**	 * 获取当前控件的下拉菜单。	 * @type Control	 * @property menu	 */		menuWidth: 'auto',		onMenuShow: function(){		this.trigger('menushow');	},		onMenuHide: function(){		this.trigger('menuhide');	},	setMenu: function(control){				control = control instanceof Dom ? control : Dom.get(control);				// 设置下拉菜单。		this.menu = control.addClass('x-dropdown').hide();				// 如果当前节点已经添加到 DOM 树，则同时添加 control 。		if(!control.parent('body')){						var tagName = this.node.tagName;						// 给 div 和 span 更多关心。			if(tagName === 'DIV' || tagName === 'SPAN'){				Dom.movable(this.node);				control.appendTo(this);			} else {				control.appendTo(this.parent());			}						if(navigator.isQuirks && control.parent().getStyle('z-index') === 0)				control.parent().setStyle('z-index', 1);		}				return this;	},		menuHidden: function () {		return Dom.isHidden(this.menu.node);	},		realignMenu: function (offsetX, offsetY) {		this.menu.align(this, 'bl', offsetX, offsetY);		return this;	},		toggleMenu: function(e){		if(e) this._menuTrigger = e.target;		return this[this.menuHidden() ? 'showMenu' : 'hideMenu']();	},		showMenu: function(){				if(this.menuHidden()){			this.menu.show();			this.realignMenu(0, -1);						var size = this.menuWidth;			if(size === 'auto') {				size = this.getSize().x;				if(size < Dom.styleNumber(this.menu.node, 'min-width'))					size = -1;			}						if(size !== -1) {				this.menu.setSize(size);			}						this.onMenuShow();						document.on('mouseup', this.hideMenu, this);		} else {			this.realignMenu(0, -1);		}				return this;	},		hideMenu: function (e) {				if(this.menuHidden()){						// 如果是来自事件的关闭，则检测是否需要关闭菜单。			if(e){				e = e.target;				if([this._menuTrigger, this.menu.node, this.node].indexOf(e) >= 0 || Dom.hasChild(this.menu.node, e) || Dom.hasChild(this.node, e)) 					return this;			}						this.onMenuHide();			this.menu.hide();			document.un('mouseup', this.hideMenu);					}				return this;	}	};